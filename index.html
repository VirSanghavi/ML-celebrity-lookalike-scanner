<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Celebrity Lookalike Scanner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- TensorFlow.js & TM Image -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.9.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

    <style>
      body {
        background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
        font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        min-height: 100vh;
        margin: 0;
        padding: 40px 20px;
        color: #f0f0f0;
      }

      h1 {
        font-size: 3rem;
        margin-bottom: 10px;
        background: linear-gradient(90deg, #00c6ff, #0072ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      p {
        font-size: 1.2rem;
        color: #ccc;
        margin-bottom: 30px;
        text-align: center;
        max-width: 600px;
      }

      video {
        margin-bottom: 25px;
        border-radius: 20px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        border: 4px solid rgba(255, 255, 255, 0.1);
        transition: transform 0.3s;
      }

      video:hover {
        transform: scale(1.02);
      }

      #label-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        max-width: 400px;
      }

      #label-container div {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(6px);
        padding: 12px 25px;
        margin: 6px 0;
        border-radius: 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        width: 100%;
        text-align: center;
        font-weight: 600;
        letter-spacing: 0.5px;
      }

      button {
        background: linear-gradient(90deg, #00c6ff, #0072ff);
        color: #fff;
        border: none;
        border-radius: 50px;
        padding: 15px 50px;
        font-size: 1rem;
        font-weight: 600;
        letter-spacing: 0.5px;
        cursor: pointer;
        transition: transform 0.3s, box-shadow 0.3s;
        margin-bottom: 30px;
      }

      button:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0, 198, 255, 0.3);
      }

      @media (max-width: 600px) {
        video {
          width: 100% !important;
        }
      }
    </style>
  </head>
  <body>
    <h1>Celebrity Lookalike Scanner</h1>
    <p>
      See which celebrity you resemble! Click below to start the AI-powered
      scanner and get instant live predictions.
    </p>

    <button type="button" onclick="init()">Start Scanner</button>
    <video id="webcam" autoplay playsinline width="300" height="300"></video>
    <div id="label-container"></div>

    <script type="text/javascript">
      const URL = "https://teachablemachine.withgoogle.com/models/A6o0yrIs5/";
      const INPUT_SIZE = 224;

      let model, webcam, labelContainer, maxPredictions;

      async function init() {
        try {
          const modelURL = URL + "model.json";
          const metadataURL = URL + "metadata.json";

          console.log("Loading model from:", modelURL);
          model = await tmImage.load(modelURL, metadataURL);
          maxPredictions = model.getTotalClasses();
          console.log("âœ… Model loaded with", maxPredictions, "classes");

          const webcamElement = document.getElementById("webcam");
          webcam = await tf.data.webcam(webcamElement, {
            facingMode: "user",
            resizeWidth: INPUT_SIZE,
            resizeHeight: INPUT_SIZE,
          });
          console.log("âœ… Webcam initialized at", INPUT_SIZE, "x", INPUT_SIZE);

          labelContainer = document.getElementById("label-container");
          labelContainer.innerHTML = "";
          for (let i = 0; i < maxPredictions; i++) {
            labelContainer.appendChild(document.createElement("div"));
          }

          window.requestAnimationFrame(loop);
        } catch (error) {
          console.error("ðŸš« Error:", error);
          alert("Error: " + error);
        }
      }

      async function loop() {
        await predict();
        window.requestAnimationFrame(loop);
      }

      async function predict() {
        const prediction = await model.predict(
          document.getElementById("webcam")
        );
        console.log("Raw prediction:", prediction);

        if (!prediction || prediction.length === 0) {
          labelContainer.children[0].innerHTML = "No prediction";
          return;
        }

        prediction.sort((a, b) => b.probability - a.probability);

        const topMatch = prediction[0];
        labelContainer.children[0].innerHTML = `ðŸ‘‘ Best Match: ${
          topMatch.className
        } (${(topMatch.probability * 100).toFixed(2)}%)`;

        for (let i = 1; i < maxPredictions; i++) {
          const p = prediction[i];
          labelContainer.children[i].innerHTML = `${p.className}: ${(
            p.probability * 100
          ).toFixed(2)}%`;
        }
      }
    </script>
  </body>
</html>
